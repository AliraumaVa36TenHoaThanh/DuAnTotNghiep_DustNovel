<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Hồ sơ cá nhân</title>

<style>
body {
	margin: 0;
	font-family: "Segoe UI", Arial, sans-serif;
	background: #f4f6f9;
}

.profile-left h3.profile-title {
	margin-top: -20px;
	margin-bottom: 8px;
	font-size: 27px;
}

.role {
	font-size: 19px;
	font-weight: 600;
	margin-bottom: 25px;
	color: #ffd43b;
}

.role.admin {
	color: #ff6b6b;
}

.container {
	display: flex;
	max-width: 1100px;
	margin: 40px auto;
	gap: 30px;
}

.profile-left {
	width: 30%;
	background: black;
	color: white;
	border-radius: 14px;
	padding: 50px;
	text-align: center;
	font-size: 20px;
}

.avatar {
	width: 110px;
	height: 110px;
	border-radius: 50%;
	background: grey;
	font-size: 42px;
	font-weight: bold;
	display: flex;
	align-items: center;
	justify-content: center;
	margin: 0 auto 15px;
}

.status {
	color: #00ff99;
	font-weight: bold;
	margin: 32px 0 25px;
}

.profile-left button {
	width: 100%;
	margin-top: 28px;
	padding: 12px;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	font-weight: 600;
}

.btn-danger {
	background: #dc3545;
	color: white;
}

.btn-danger:hover {
	background: #bb2d3b;
}

.btn-logout {
	background: #333;
	color: white;
}

.btn-logout:hover {
	background: #222;
}

.profile-right {
	width: 70%;
	background: white;
	border-radius: 14px;
	padding: 60px;
}

h2 {
	margin-top: 0;
	margin-bottom: 10px;
}

label {
	font-weight: 600;
	display: block;
	margin-bottom: 6px;
}

input {
	width: 100%;
	padding: 11px;
	margin-bottom: 6px;
	border-radius: 8px;
	border: 1px solid #ccc;
	font-size: 15px;
}

input:disabled {
	background: #eee;
	cursor: not-allowed;
}

.error {
	color: #dc3545;
	font-size: 14px;
	margin-bottom: 12px;
}

.success {
	background: #e6fffa;
	color: #0f5132;
	padding: 14px;
	border-radius: 10px;
	margin-bottom: 20px;
}

.btn-edit {
	background: #6f42c1;
	color: white;
	padding: 10px 18px;
	border-radius: 8px;
	border: none;
	cursor: pointer;
	font-weight: 600;
	margin-bottom: 25px;
}

.btn-edit:hover {
	background: #5a32a3;
}

#btnUpdate {
	background: #198754;
	color: white;
	padding: 11px 20px;
	border-radius: 8px;
	border: none;
	cursor: pointer;
	font-weight: 600;
}

#btnUpdate:hover {
	background: #157347;
}

.form-actions {
	margin-top: 20px;
	display: flex;
	align-items: center;
	gap: 18px;
}

a {
	text-decoration: none;
	font-weight: 600;
	color: #6f42c1;
}
</style>

<script>
        function enableEdit() {
            document.querySelectorAll(".editable").forEach(i => i.disabled = false);
            document.getElementById("btnUpdate").style.display = "inline-block";
        }

        window.onload = function () {
            const hasError = document.querySelector(".error") !== null;
            if (hasError) {
                enableEdit();
            }
        }

        function confirmLogout() {
            return confirm("Bạn có chắc chắn muốn đăng xuất không?");
        }
        
    </script>
        <style>
        body {
            min-height: 100vh;
            background: url("/images/bglogin.jpg") no-repeat center center fixed;
            background-size: cover;
        }
    </style>
</head>

<body>
	<div class="container">

		<!-- BEN TRAI -->
		<div class="profile-left">
			<h3 class="profile-title">Thông tin tài khoản</h3>

			<div class="avatar"
				th:text="${#strings.toUpperCase(#strings.substring(user.tenDangNhap,0,1))}">
			</div>

			<h3 th:text="${user.tenDangNhap}"></h3>
			<strong th:text="${user.email}"></strong>

			<div class="status">Đang hoạt động</div>

			<form th:action="@{/DustNovel/user/delete}" method="post"
				onsubmit="return confirm('Bạn có chắc chắn muốn xóa tài khoản? Hành động này không thể khôi phục!')">
				<button class="btn-danger">Xóa tài khoản</button>
			</form>

			<form th:action="@{/DustNovel/logout}" method="post"
				onsubmit="return confirmLogout()">
				<button class="btn-logout">Đăng xuất</button>
			</form>
		</div>

		<!-- BEN PHAI -->
		<div class="profile-right">
			<h2>CẬP NHẬT THÔNG TIN TÀI KHOẢN</h2>

			<div th:if="${success != null and success == true}" class="success">
				Cập nhật thông tin tài khoản thành công</div>

			<button type="button" class="btn-edit" onclick="enableEdit()">
				Chỉnh sửa hồ sơ</button>

			<form th:action="@{/DustNovel/user/profile/update}" method="post">

				<!-- TEN DANG NHAP: KHOA + GUI NGAM -->
				<label>Tên đăng nhập</label> <input disabled
					th:value="${tenDangNhapValue != null ? tenDangNhapValue : user.tenDangNhap}">
				<input type="hidden" name="tenDangNhap"
					th:value="${tenDangNhapValue != null ? tenDangNhapValue : user.tenDangNhap}">
				<div class="error" th:if="${tenDangNhapError}"
					th:text="${tenDangNhapError}"></div>

				<!-- EMAIL: KHOA + GUI NGAM -->
				<label>Email</label> <input disabled
					th:value="${emailValue != null ? emailValue : user.email}">
				<input type="hidden" name="email"
					th:value="${emailValue != null ? emailValue : user.email}">
				<div class="error" th:if="${emailError}" th:text="${emailError}"></div>

				<h4>Đổi mật khẩu (không bắt buộc)</h4>
				<input class="editable" disabled type="password" name="matKhauMoi"
					th:value="${matKhauMoi}" placeholder="Mật khẩu mới">
				<div class="error" th:if="${matKhauMoiError}"
					th:text="${matKhauMoiError}"></div>

				<input class="editable" disabled type="password"
					name="xacNhanMatKhau" th:value="${xacNhanMatKhau}"
					placeholder="Xác nhận mật khẩu mới">
				<div class="error" th:if="${xacNhanMatKhauError}"
					th:text="${xacNhanMatKhauError}"></div>

				<div class="form-actions">
					<button id="btnUpdate" type="submit" style="display: none">
						Cập nhật thông tin</button>
					<a href="/DustNovel/home">← Quay về trang chủ</a>
				</div>
			</form>
		</div>

	</div>
</body>
</html>
