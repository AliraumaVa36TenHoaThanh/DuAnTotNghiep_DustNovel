
<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>H·ªì s∆° c√° nh√¢n</title>

<style>
body {
	margin: 0;
	font-family: "Segoe UI", Arial, sans-serif;
	background: #f4f6f9;
}

.profile-left h3.profile-title {
	margin-top: -20px;
	margin-bottom: 8px;
	font-size: 27px;
}

.role {
	font-size: 19px;
	font-weight: 600;
	margin-bottom: 25px;
	color: #ffd43b;
}

.role.admin {
	color: #ff6b6b;
}

.container {
	display: flex;
	max-width: 1100px;
	margin: 40px auto;
	gap: 30px;
}

.profile-left {
	width: 30%;
	background: black;
	color: white;
	border-radius: 14px;
	padding: 50px;
	text-align: center;
	font-size: 20px;
}

.avatar {
	width: 110px;
	height: 110px;
	border-radius: 50%;
	background: grey;
	font-size: 42px;
	font-weight: bold;
	display: flex;
	align-items: center;
	justify-content: center;
	margin: 0 auto 15px;
}

.status {
	color: #00ff99;
	font-weight: bold;
	margin: 32px 0 25px;
}

.profile-left button {
	width: 100%;
	margin-top: 28px;
	padding: 12px;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	font-weight: 600;
}

.btn-danger {
	background: #dc3545;
	color: white;
}

.btn-danger:hover {
	background: #bb2d3b;
}

.btn-logout {
	background: #333;
	color: white;
}

.btn-logout:hover {
	background: #222;
}

.profile-right {
	width: 70%;
	background: white;
	border-radius: 14px;
	padding: 60px;
}

h2 {
	margin-top: 0;
	margin-bottom: 10px;
}

label {
	font-weight: 600;
	display: block;
	margin-bottom: 6px;
}

input {
	width: 100%;
	padding: 11px;
	margin-bottom: 6px;
	border-radius: 8px;
	border: 1px solid #ccc;
	font-size: 15px;
}

input:disabled {
	background: #eee;
	cursor: not-allowed;
}

.error {
	color: #dc3545;
	font-size: 14px;
	margin-bottom: 12px;
}

<
style>*, *::before, *::after {
	box-sizing: border-box;
}

body {
	min-height: 100vh;
	background: url("/images/bglogin.jpg");
	background-size: cover;
	margin: 0;
	font-family: "Segoe UI", Arial, sans-serif;
}

.profile-bg {
	min-height: 100vh;
	padding-top: 40px;
}

.header {
	height: 315px;
	background: #cfcfcf;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 40px;
	letter-spacing: 6px;
	color: rgba(0, 0, 0, 0.15);
	font-weight: 700;
	cursor: pointer;
	background-size: cover;
	background-position: top;
	background-repeat: no-repeat;
}

.container {
	max-width: 1150px;
	margin: -60px auto 50px;
	display: flex;
	gap: 30px;
}

.profile-left {
	width: 320px;
	background: white;
	border-radius: 16px;
	padding: 25px;
	text-align: center;
	box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.avatar {
	width: 120px;
	height: 120px;
	border-radius: 50%;
	background: #d9d9d9;
	font-size: 48px;
	font-weight: bold;
	display: flex;
	align-items: center;
	justify-content: center;
	margin: -80px auto 10px;
}

.profile-left h3 {
	margin: 8px 0 2px;
}

.profile-left p {
	margin: 0;
	color: #555;
	font-size: 14px;
}

.status {
	color: #28a745;
	font-weight: bold;
	margin: 10px 0 20px;
}

.stats {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	gap: 10px;
	margin-bottom: 20px;
}

.stats div {
	background: #f1f3f5;
	border-radius: 10px;
	padding: 10px 0;
	font-size: 14px;
}

.stats strong {
	display: block;
	font-size: 18px;
}

.profile-left button {
	width: 100%;
	padding: 11px;
	border-radius: 10px;
	border: none;
	font-weight: 600;
	cursor: pointer;
	margin-top: 10px;
}

.btn-danger {
	background: #e9ecef;
	color: black;
}

.btn-danger:hover {
	background: black;
	color: white;
}

.btn-logout {
	background: #e9ecef;;
	color: black border: 1px solid white;
}

.btn-logout:hover {
	background: black;
	color: white;
}

.profile-right {
	flex: 1;
	background: white;
	border-radius: 16px;
	padding: 40px;
	box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.profile-right h2 {
	margin-top: 0;
}

label {
	display: block;
	font-weight: 600;
	margin-top: 18px;
}

input {
	width: 100%;
	padding: 13px;
	margin-top: 6px;
	border-radius: 10px;
	border: 1px solid #ccc;
	font-size: 15px;
	background: #f2f2f2;
}

input:disabled {
	cursor: not-allowed;
}

input.editable {
	background: white;
}

.error {
	color: #dc3545;
	font-size: 14px;
	margin-top: 4px;
}

.success {
	background: #e6fffa;
	color: #0f5132;
	padding: 14px;
	border-radius: 10px;
	margin-bottom: 20px;
}

.btn-edit {
	background: #6f42c1;
	color: white;
	padding: 10px 18px;
	border-radius: 8px;
	border: none;
	cursor: pointer;
	font-weight: 600;
	margin-bottom: 25px;
}

.btn-edit:hover {
	background: #5a32a3;
}

#btnUpdate {
	background: #198754;
	color: white;
	padding: 11px 20px;
	border-radius: 8px;
	border: none;
	cursor: pointer;
	font-weight: 600;
}

#btnUpdate:hover {
	background: #157347;
}

.form-actions {
	margin-top: 20px;
	display: flex;
	align-items: center;
	gap: 18px;
}

a {
	text-decoration: none;
	font-weight: 600;
	color: #6f42c1;
}
</style>

<script>
        function enableEdit() {
            document.querySelectorAll(".editable").forEach(i => i.disabled = false);
            document.getElementById("btnUpdate").style.display = "inline-block";
        }

        window.onload = function () {
            const hasError = document.querySelector(".error") !== null;
            if (hasError) {
                enableEdit();
            }
        }

        function confirmLogout() {
            return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?");
        }
    </script>
</head>

<body>
	<div class="container">

		<!-- BEN TRAI -->
		<div class="profile-left">
			<h3 class="profile-title">Th√¥ng tin t√†i kho·∫£n</h3>

			<div class="role"
				th:classappend="${user.vaiTro == 'ADMIN'} ? 'admin' : ''"
				th:text="${user.vaiTro == 'ADMIN'} ? 'Quy·ªÅn: Qu·∫£n tr·ªã vi√™n' : 'Quy·ªÅn: Ng∆∞·ªùi d√πng'">
			</div>

			<div class="avatar"
				th:text="${#strings.toUpperCase(#strings.substring(user.tenDangNhap,0,1))}">
			</div>

			<h3 th:text="${user.tenDangNhap}"></h3>
			<strong th:text="${user.email}"></strong>

			<div class="status">ƒêang ho·∫°t ƒë·ªông</div>

			<form th:action="@{/DustNovel/user/delete}" method="post"
				onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ kh√¥i ph·ª•c!')">
				<button class="btn-danger">X√≥a t√†i kho·∫£n</button>
			</form>

			<form th:action="@{/DustNovel/logout}" method="post"
				onsubmit="return confirmLogout()">
				<button class="btn-logout">ƒêƒÉng xu·∫•t</button>
			</form>
		</div>

		<!-- BEN PHAI -->
		<div class="profile-right">
			<h2>C·∫¨P NH·∫¨T TH√îNG TIN T√ÄI KHO·∫¢N</h2>

			<div th:if="${success != null and success == true}" class="success">
				C·∫≠p nh·∫≠t th√¥ng tin t√†i kho·∫£n th√†nh c√¥ng</div>

			<button type="button" class="btn-edit" onclick="enableEdit()">
				Ch·ªânh s·ª≠a h·ªì s∆°</button>

			<form th:action="@{/DustNovel/user/profile/update}" method="post">

				<!-- TEN DANG NHAP: KHOA + GUI NGAM -->
				<label>T√™n ƒëƒÉng nh·∫≠p</label> <input disabled
					th:value="${tenDangNhapValue != null ? tenDangNhapValue : user.tenDangNhap}">
				<input type="hidden" name="tenDangNhap"
					th:value="${tenDangNhapValue != null ? tenDangNhapValue : user.tenDangNhap}">
				<div class="error" th:if="${tenDangNhapError}"
					th:text="${tenDangNhapError}"></div>

				<!-- EMAIL: KHOA + GUI NGAM -->
				<label>Email</label> <input disabled
					th:value="${emailValue != null ? emailValue : user.email}">
				<input type="hidden" name="email"
					th:value="${emailValue != null ? emailValue : user.email}">
				<div class="error" th:if="${emailError}" th:text="${emailError}"></div>

				<h4>ƒê·ªïi m·∫≠t kh·∫©u (kh√¥ng b·∫Øt bu·ªôc)</h4>
				<input class="editable" disabled type="password" name="matKhauMoi"
					th:value="${matKhauMoi}" placeholder="M·∫≠t kh·∫©u m·ªõi">
				<div class="error" th:if="${matKhauMoiError}"
					th:text="${matKhauMoiError}"></div>

				<input class="editable" disabled type="password"
					name="xacNhanMatKhau" th:value="${xacNhanMatKhau}"
					placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi">
				<div class="error" th:if="${xacNhanMatKhauError}"
					th:text="${xacNhanMatKhauError}"></div>

				<div class="form-actions">
					<button id="btnUpdate" type="submit" style="display: none">
						C·∫≠p nh·∫≠t th√¥ng tin</button>
					<a href="/DustNovel/home">‚Üê Quay v·ªÅ trang ch·ªß</a>
				</div>
			</form>
		</div>

	</div>
	.btn-edit { background: #198754; color: white; padding: 12px 26px;
	border-radius: 10px; border: none; cursor: pointer; font-weight: 600;
	margin: 15px 0 25px; } .btn-edit:hover { background: black; color:
	white; } .form-actions { margin-top: 30px; display: flex; align-items:
	center; gap: 25px; } #btnUpdate { display: none; background: #198754;
	color: white; padding: 12px 26px; border-radius: 10px; border: none;
	font-weight: 600; cursor: pointer; } #btnUpdate:hover { background:
	black; color: white; } a { text-decoration: none; font-weight: 600;
	color: #198754; } a:hover { color: red; } .password-wrapper { position:
	relative; width: 100%; } .password-wrapper input { width: 100%;
	padding: 13px 44px 13px 13px; box-sizing: border-box; }

	.toggle-password { position: absolute; right: 14px; top: 50%;
	transform: translateY(-50%); cursor: pointer; font-size: 18px; color:
	#666; user-select: none; } .toggle-password:hover { color: #000; }

	.avatar { position: relative; width: 120px; height: 120px;
	border-radius: 50%; background: #d9d9d9; font-size: 48px; font-weight:
	bold; display: flex; align-items: center; justify-content: center;
	cursor: pointer; } .avatar-box { position: relative; width: 120px;
	height: 120px; margin: -80px auto 10px; border-radius: 50%; overflow:
	hidden; } .avatar-fallback { position: absolute; inset: 0; background:
	#d9d9d9; display: flex; align-items: center; justify-content: center;
	font-size: 48px; font-weight: bold; color: #555; z-index: 1; }

	.avatar-img { position: absolute; inset: 0; width: 100%; height: 100%;
	object-fit: cover; z-index: 2; } .avatar-action { position: absolute;
	top: 50%; right: 8px; transform: translateY(-50%); opacity: 0; z-index:
	3; transition: 0.25s ease; display: flex; gap: 6px; }

	.avatar-action.left { right: 87px; top: 50px; } .avatar-action.right {
	right: 1px; top: 54px; } .avatar-action button { font-size: 22px; }

	.avatar-action label, .avatar-action button { width: 32px; height:
	32px; border-radius: 50%; background: #d3ffff; border: none; display:
	flex; align-items: center; justify-content: center; cursor: pointer;
	box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25); } .avatar-box:hover
	.avatar-action { opacity: 1; } .banner-action { position: absolute;
	top: 20px; right: 20px; display: flex; gap: 8px; opacity: 0; z-index:
	3; transition: 0.25s ease; } .header:hover .banner-action { opacity: 1;
	} .banner-action button { width: 32px; height: 32px; border-radius:
	50%; background: #d3ffff; border: none; display: flex; align-items:
	center; justify-content: center; cursor: pointer; font-size: 22px;
	font-weight: 900; line-height: 1; box-shadow: 0 3px 8px rgba(0, 0, 0,
	0.25); } }
	</style>

	<script>
	function enableEdit() {
	    document.querySelectorAll(".editable").forEach(i => i.disabled = false);
	    document.getElementById("btnUpdate").style.display = "inline-block";
	}
	
	window.onload = function () {
	    if (document.querySelector(".error")) {
	        enableEdit();
	    }
	}
	
	function confirmLogout() {
	    return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?");
	}
	
	function togglePassword(id, icon) {
	    const input = document.getElementById(id);
	    if (input.type === "password") {
	        input.type = "text";
	        icon.textContent = "üëÅ‚Äç";
	    } else {
	        input.type = "password";
	        icon.textContent = "üëÅ";
	    }
	}
		
	function confirmDeleteAvatar() {
	    return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ·∫£nh ƒë·∫°i di·ªán kh√¥ng?");
	}
	
	
</script>
</head>

<body>
	<!-- ================= HEADER (BANNER) ================= -->
	<div class="header"
		onclick="document.getElementById('bannerInput').click()"
		th:style="${user.banner != null} ? 'background-image:url(' + @{${user.banner}} + ')' : ''">
		‚ûï DustNovel
		<!-- INPUT FILE ·∫®N -->
		<form th:action="@{/DustNovel/user/banner}" method="post"
			enctype="multipart/form-data">
			<input id="bannerInput" type="file" name="file" accept="image/*"
				hidden onchange="this.form.submit()">
		</form>
		<!-- N√öT X√ìA (GI·ªÆ L·∫†I) -->
		<div class="banner-action" onclick="event.stopPropagation()">
			<form th:if="${user.banner != null}"
				th:action="@{/DustNovel/user/banner/delete}" method="post"
				onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a banner kh√¥ng?')">
				<button type="submit">üóë</button>
			</form>
		</div>
	</div>
	<!-- =================================================== -->



	<div class="container">
		<!-- ===== LEFT ===== -->
		<div class="profile-left">
			<div class="avatar-box">

				<!-- L·ªöP N·ªÄN + CH·ªÆ (LU√îN T·ªíN T·∫†I) -->
				<div class="avatar-fallback"
					th:text="${#strings.toUpperCase(#strings.substring(user.tenDangNhap,0,1))}">
				</div>

				<!-- L·ªöP ·∫¢NH (CH·ªà HI·ªÜN KHI C√ì AVATAR) -->
				<img th:if="${user.avatar != null}" th:src="@{${user.avatar}}"
					class="avatar-img" />

				<!-- ICON UPLOAD -->
				<form th:action="@{/DustNovel/user/avatar}" method="post"
					enctype="multipart/form-data" class="avatar-action left">
					<label> ‚ûï <input type="file" name="file" accept="image/*"
						hidden onchange="this.form.submit()">
					</label>
				</form>

				<!-- ICON DELETE -->
				<form th:if="${user.avatar != null}"
					th:action="@{/DustNovel/user/avatar/delete}" method="post"
					class="avatar-action right" onsubmit="return confirmDeleteAvatar()">
					<button type="submit">üóë</button>
				</form>

			</div>


			<h3 th:text="${user.tenDangNhap}"></h3>
			<p th:text="${user.email}"></p>

			<div class="status">ƒêang ho·∫°t ƒë·ªông</div>

			<div class="stats">
				<div>
					<strong>0</strong>Truy·ªán
				</div>
				<div>
					<strong>0</strong>Theo d√µi
				</div>
				<div>
					<strong>0</strong>B√¨nh lu·∫≠n
				</div>
			</div>

			<form th:action="@{/DustNovel/user/delete}" method="post"
				onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n?')">
				<button class="btn-danger">X√≥a t√†i kho·∫£n</button>
			</form>

			<form th:action="@{/DustNovel/logout}" method="post"
				onsubmit="return confirmLogout()">
				<button class="btn-logout">ƒêƒÉng xu·∫•t</button>
			</form>
		</div>

		<!-- ===== RIGHT ===== -->
		<div class="profile-right">

			<h2>TH√îNG TIN T√ÄI KHO·∫¢N</h2>

			<button type="button" class="btn-edit" onclick="enableEdit()">
				Thay ƒë·ªïi m·∫≠t kh·∫©u</button>

			<div th:if="${success != null and success == true}" class="success">
				C·∫≠p nh·∫≠t m·∫≠t kh·∫©u th√†nh c√¥ng</div>

			<form th:action="@{/DustNovel/user/profile/update}" method="post">

				<label>T√™n ƒëƒÉng nh·∫≠p</label> <input disabled
					th:value="${tenDangNhapValue != null ? tenDangNhapValue : user.tenDangNhap}">
				<input type="hidden" name="tenDangNhap"
					th:value="${tenDangNhapValue != null ? tenDangNhapValue : user.tenDangNhap}">
				<div class="error" th:if="${tenDangNhapError}"
					th:text="${tenDangNhapError}"></div>

				<label>Email</label> <input disabled
					th:value="${emailValue != null ? emailValue : user.email}">
				<input type="hidden" name="email"
					th:value="${emailValue != null ? emailValue : user.email}">
				<div class="error" th:if="${emailError}" th:text="${emailError}"></div>

				<label>ƒê·ªïi m·∫≠t kh·∫©u (kh√¥ng b·∫Øt bu·ªôc)</label>
				<div class="password-wrapper">
					<input id="matKhauMoi" class="editable" disabled type="password"
						name="matKhauMoi" placeholder="M·∫≠t kh·∫©u m·ªõi"
						th:value="${matKhauMoi}"> <span class="toggle-password"
						onclick="togglePassword('matKhauMoi', this)">üëÅ</span>
				</div>
				<div class="error" th:if="${matKhauMoiError}"
					th:text="${matKhauMoiError}"></div>

				<div class="password-wrapper">
					<input id="xacNhanMatKhau" class="editable" disabled
						type="password" name="xacNhanMatKhau"
						placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi" th:value="${xacNhanMatKhau}">
					<span class="toggle-password"
						onclick="togglePassword('xacNhanMatKhau', this)">üëÅ</span>
				</div>
				<div class="error" th:if="${xacNhanMatKhauError}"
					th:text="${xacNhanMatKhauError}"></div>


				<div class="form-actions">
					<button id="btnUpdate" type="submit">C·∫≠p nh·∫≠t m·∫≠t kh·∫©u</button>
					<a href="/DustNovel/home">‚Üê Quay v·ªÅ trang ch·ªß</a>
				</div>
			</form>
		</div>
	</div>
</body>
</html>
