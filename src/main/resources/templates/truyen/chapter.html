<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="layout/main :: content">
<div th:fragment="content">
    <h4 class="text-center" th:text="${chuong.tieuDe}"></h4>
    <p class="text-center text-muted">
        C·∫≠p nh·∫≠t:
        <span th:text="${#temporals.format(chuong.ngayTao, 'dd/MM/yyyy HH:mm')}"></span>
    </p>
    <hr>
    <div class="fs-5 lh-lg" th:if="${canRead}" th:utext="${chuong.noiDung}"></div>
    <hr>

    <div class="d-flex justify-content-between">
        <a th:if="${chuongTruoc != null}" th:href="@{/DustNovel/chuong/{id}(id=${chuongTruoc.id})}" class="btn btn-outline-secondary">‚¨Ö Ch∆∞∆°ng tr∆∞·ªõc</a>
        <span th:unless="${chuongTruoc != null}"></span>

        <a th:href="@{/DustNovel/truyen/{id}(id=${chuong.truyen.id})}" class="btn btn-outline-primary">üè† Quay l·∫°i</a>

        <div th:if="${chuongSau != null}">
            <a th:if="${@permissionService.canReadChuong(chuongSau, currentUser)}" 
               th:href="@{/DustNovel/chuong/{id}(id=${chuongSau.id})}" 
               class="btn btn-outline-secondary">Ch∆∞∆°ng sau ‚û°</a>
            
            <button th:unless="${@permissionService.canReadChuong(chuongSau, currentUser)}" 
                    class="btn btn-outline-danger" 
                    data-bs-toggle="modal" 
                    th:data-bs-target="'#muaChuongModal__' + ${chuongSau.id}">
                Ch∆∞∆°ng sau üîí
            </button>
        </div>
        <span th:unless="${chuongSau != null}"></span>
    </div>

    <div th:if="${chuongSau != null && !@permissionService.canReadChuong(chuongSau, currentUser)}">
        <div class="modal fade" th:id="'muaChuongModal__' + ${chuongSau.id}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold">Mua ch∆∞∆°ng ti·∫øp theo</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <p class="mb-1">B·∫°n ƒëang mua: <b th:text="${chuongSau.tieuDe}"></b></p>
                        <h4 class="text-danger fw-bold"><span th:text="${T(com.fpoly.config.GiaChuongKhoa).gia_chuong}"></span> Token</h4>
                        <hr>
                        <div th:if="${currentUser != null}" class="bg-light p-2 rounded">
                            <span>S·ªë d∆∞ c·ªßa √¥ng: </span>	
                            <b class="text-primary"><span th:text="${currentUser.token}"></span> Token</b>
                        </div>
                        <div th:unless="${currentUser != null}">
                            <div class="alert alert-warning py-2 mb-0">
                                ‚ö†Ô∏è Ph·∫£i <a th:href="@{/DustNovel/login}" class="fw-bold">ƒëƒÉng nh·∫≠p</a> m·ªõi mua ƒë∆∞·ª£c √¥ng gi√°o ·∫°!
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a th:href="@{/DustNovel/truyen/{id}(id=${chuong.truyen.id})}" class="btn btn-secondary">H·ªßy & V·ªÅ chi ti·∫øt</a>
                        
                        <form th:if="${currentUser != null}" th:action="@{/DustNovel/chuong/{id}/mua(id=${chuongSau.id})}" method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>	
                            <button type="submit" class="btn btn-danger px-4" 
                                    th:disabled="${currentUser.token < T(com.fpoly.config.GiaChuongKhoa).gia_chuong}">
                                üí∞ X√°c nh·∫≠n mua & ƒê·ªçc ti·∫øp
                            </button>
                        </form>
                        
                        <a th:if="${currentUser == null}" th:href="@{/DustNovel/login}" class="btn btn-primary">ƒêƒÉng nh·∫≠p</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</html>