<div th:fragment="content">
<div class="card">
    <div class="card-header">
        <h4>Thêm truyện</h4>
    </div>

    <div class="card-body">
        <form th:action="@{/DustNovel/themtruyen}" th:object="${truyen}" method="post">

            <div class="mb-3">
                <label>Tên truyện</label>
                <input type="text" th:field="*{tenTruyen}" class="form-control" required>
            </div>

            <div class="mb-3">
                <label>Mô tả</label>
                <textarea th:field="*{moTa}" class="form-control"></textarea>
            </div>

            <div class="mb-3">
                <label>Tên tác giả</label>
                <input type="text" th:field="*{tenTacGia}" class="form-control">
            </div>

            <div class="mb-3">
                <label>Loại truyện</label>
                <select th:field="*{loaiTruyen}" class="form-select">
                    <option value="SÁNG_TÁC">Sáng tác</option>
                    <option value="DỊCH">Dịch</option>
                </select>
            </div>
			
			
			<div class="mb-3">
    <label class="form-label">Thể loại</label>

    <div class="d-flex flex-wrap gap-2">
        <label th:each="tl : ${dsTheLoai}" class="badge bg-light text-dark border">
            <input type="checkbox"
                   name="theLoaiIds"
                   th:value="${tl.id}">
            <span th:text="${tl.tenTheLoai}"></span>
        </label>
    </div>
</div>
			
			
			
            <div class="mb-3">
                <label>Trạng thái</label>
                <select th:field="*{trangThai}" class="form-select">
                    <option value="ĐANG_RA">Đang ra</option>
                    <option value="HOÀN_THÀNH">Hoàn thành</option>
                </select>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" th:field="*{tag18}">
                <label class="form-check-label">Truyện 18+</label>
            </div>

            
            <div class="mb-3">
    <label class="form-label">Ảnh bìa (URL)</label>

    <input type="text"
           th:field="*{anhBia}"
           class="form-control"
           placeholder="Dán link ảnh bìa (tỉ lệ 3:4)"
           oninput="previewAnhBia(this.value)">

    <div class="mt-3">
        <div class="border rounded overflow-hidden shadow-sm"
             style="width:180px; aspect-ratio:3/4; background:#f8f9fa;">
            <img id="previewAnhBia"
                 th:src="*{anhBia} ?: @{/images/default.jpg}"
                 style="width:100%; height:100%; object-fit:cover;"
                 alt="Ảnh bìa">
        </div>
    </div>
</div>
            
            

            <button class="btn btn-primary">Lưu truyện</button>
        </form>
    </div>
</div>
</div>

<script>
    function previewAnhBia(url) {
        const img = document.getElementById('previewAnhBia');
        if (url && url.startsWith('http')) {
            img.src = url;
        } else {
            img.src = '/images/default.jpg';
        }
    }
</script>