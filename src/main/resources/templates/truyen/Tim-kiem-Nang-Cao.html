<div th:fragment="content">

<!-- ================= STYLE ================= -->
<style>
/* ===== TI√äU ƒê·ªÄ CH√çNH ===== */
.search-title-main {
	text-align: center;
	font-size: 1.9rem;          /* to v·ª´a */
	font-weight: 700;
	margin-bottom: 24px;
	color: #111827;
}

/* ===== KHUNG TH·ªÇ LO·∫†I ===== */
.genre-wrapper {
	padding: 16px;
	margin-top: 8px;
	border-radius: 10px;
	background: #fff;
	border: 1px solid #00000030; /* vi·ªÅn ƒëen nh·∫π */
}

/* ===== ITEM TH·ªÇ LO·∫†I ===== */
.genre-item {
	cursor: pointer;
	user-select: none;
	display: flex;
	align-items: center;
	gap: 8px;
	margin-bottom: 8px;
	font-size: 14px;
	padding: 6px 8px;
	border-radius: 6px;
}

.genre-item:hover {
	background: #f9fafb;
}

/* ===== CHECKBOX GI·∫¢ ===== */
.fake-checkbox {
	width: 16px;
	height: 16px;
	border: 1.5px solid #555;
	border-radius: 3px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
	font-weight: bold;
	color: white;
}

/* ===== INCLUDE ===== */
.genre-include .fake-checkbox {
	background: #22c55e;
	border-color: #22c55e;
}
.genre-include .fake-checkbox::after { content: "‚úî"; }
.genre-include .genre-name {
	color: #16a34a;
	font-weight: 600;
}

/* ===== EXCLUDE ===== */
.genre-exclude .fake-checkbox {
	background: #ef4444;
	border-color: #ef4444;
}
.genre-exclude .fake-checkbox::after {
	content: "‚õî";
	font-size: 10px;
}
.genre-exclude .genre-name {
	color: #dc2626;
	text-decoration: line-through;
}

/* ===== K·∫æT QU·∫¢ ===== */
.result-title {
	text-align: center;
	font-size: 1.8rem;
	font-weight: 700;
	margin: 30px 0 14px;
	color: #111827;
}

.result-empty {
	text-align: center;
	font-size: 1.2rem;
	font-weight: 500;
	color: #6b7280;
	margin-top: 12px;
}
</style>

<!-- ================= FORM T√åM KI·∫æM ================= -->
<div class="card shadow-sm mb-4">
	<div class="card-body">

		<h5 class="search-title-main">üîç T√¨m ki·∫øm n√¢ng cao</h5>

		<form th:action="@{/DustNovel/truyen/tim-kiem-nang-cao}" method="get">

			<div class="mb-3">
				<label class="form-label">T√™n truy·ªán</label>
				<input type="text" name="tenTruyen" class="form-control">
			</div>

			<div class="mb-3">
				<label class="form-label">T√™n t√°c gi·∫£</label>
				<input type="text" name="tenTacGia" class="form-control">
			</div>

			<div class="mb-3">
				<label class="form-label">Th·ªÉ lo·∫°i</label>

				<div class="genre-wrapper">
					<div class="row">
						<div class="col-md-3" th:each="tl : ${theLoais}">
							<div class="genre-item" onclick="toggleGenre(this)">
								<span class="fake-checkbox"></span>
								<span class="genre-name" th:text="${tl.tenTheLoai}"></span>
								<input type="hidden"
								       th:attr="data-name='theLoai[' + ${tl.id} + ']'"
								       value="0">
							</div>
						</div>
					</div>
				</div>

			</div>

			<div class="mb-3">
				<label class="form-label">Lo·∫°i truy·ªán</label>
				<select name="loaiTruyen" class="form-select">
					<option value="">T·∫•t c·∫£</option>
					<option th:value="${T(com.fpoly.model.enums.LoaiTruyen).S√ÅNG_T√ÅC}">
						S√°ng t√°c
					</option>
					<option th:value="${T(com.fpoly.model.enums.LoaiTruyen).D·ªäCH}">
						Truy·ªán d·ªãch
					</option>
				</select>
			</div>

			<div class="mb-3">
				<label class="form-label">N·ªôi dung 18+</label>
				<select name="showTag18" class="form-select">
					<option value="">T·∫•t c·∫£</option>
					<option value="true">Ch·ªâ truy·ªán 18+</option>
					<option value="false">Kh√¥ng truy·ªán 18+</option>
				</select>
			</div>

			<button class="btn btn-primary w-100">üîé T√¨m ki·∫øm</button>
		</form>
	</div>
</div>

<!-- ================= CH∆ØA T√åM KI·∫æM ================= -->
<div class="text-center mt-4" th:if="${!searched}">
	üîç Vui l√≤ng nh·∫≠p ƒëi·ªÅu ki·ªán v√† b·∫•m <b>T√¨m ki·∫øm</b> ƒë·ªÉ xem k·∫øt qu·∫£
</div>

<!-- ================= K·∫æT QU·∫¢ ================= -->
<div class="mt-4" th:if="${searched}">

	<h5 class="result-title">K·∫øt qu·∫£ t√¨m ki·∫øm</h5>

	<div th:if="${#lists.isEmpty(dsTruyen)}">
		<div class="result-empty">üí≠ Kh√¥ng t√¨m th·∫•y truy·ªán n√†o</div>
	</div>

	<div class="row" th:if="${!#lists.isEmpty(dsTruyen)}">
		<div class="col-md-3 mb-4" th:each="truyen : ${dsTruyen}">
			<div class="card h-100 shadow-sm">

				<img th:src="${truyen.anhBia}" class="card-img-top"
				     style="height:220px;object-fit:cover">

				<div class="card-body d-flex flex-column">

					<h6 class="fw-bold" th:text="${truyen.tenTruyen}"></h6>

					<p class="mb-1">
						T√°c gi·∫£: <span th:text="${truyen.tenTacGia}"></span>
					</p>

					<p class="mb-1">
						<span th:if="${truyen.loaiTruyen.name() == 'SANG_TAC'}"
						      class="badge bg-success">S√°ng t√°c</span>
						<span th:if="${truyen.loaiTruyen.name() == 'DICH'}"
						      class="badge bg-info">Truy·ªán d·ªãch</span>
					</p>

					<p class="mb-1">
						<span th:each="tl : ${truyen.theLoais}"
						      class="badge bg-secondary me-1"
						      th:text="${tl.tenTheLoai}"></span>
					</p>

					<p class="text-danger small" th:if="${truyen.tag18}">
						üîû N·ªôi dung 18+
					</p>

					<a class="btn btn-outline-primary btn-sm mt-auto"
					   th:href="@{/DustNovel/truyen/{id}(id=${truyen.id})}">
						Xem
					</a>
				</div>

			</div>
		</div>
	</div>
</div>

<!-- ================= JS ================= -->
<script>
function toggleGenre(el) {
	const hidden = el.querySelector("input[type='hidden']");
	let state = Number(hidden.value);

	el.classList.remove("genre-include", "genre-exclude");

	if (state === 0) {
		state = 1;
		el.classList.add("genre-include");
		hidden.name = hidden.dataset.name;
	} else if (state === 1) {
		state = -1;
		el.classList.add("genre-exclude");
		hidden.name = hidden.dataset.name;
	} else {
		state = 0;
		hidden.value = "0";
		hidden.removeAttribute("name");
		return;
	}
	hidden.value = state;
}
</script>

</div>
